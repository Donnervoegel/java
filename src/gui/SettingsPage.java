/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

package gui;

import database.AccountAccess;

import javax.swing.*;
import java.awt.event.*;
import gui.utils.*;
import gui.types.MSPanel;
import types.Account;

/**
 *
 * @author Colin
 */
public class SettingsPage extends MSPanel {
    private Account a;

    /**
     * Creates new form SettingsPage
     */
    public SettingsPage(Account a) {
	super("User Settings");

	this.a = a;

        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        curr_pass_field = new javax.swing.JPasswordField();
        jLabel2 = new javax.swing.JLabel();
        new_pass_field = new javax.swing.JPasswordField();
        jLabel3 = new javax.swing.JLabel();
        new_pass_field2 = new javax.swing.JPasswordField();
        confirm_button = new javax.swing.JButton();
        cancel_button = new javax.swing.JButton();

        setLayout(new java.awt.GridLayout(4, 2, 20, 50));

        jLabel1.setText("Current Password");
        jLabel1.setName("curr_pass"); // NOI18N
        add(jLabel1);
        add(curr_pass_field);

        jLabel2.setText("New Password");
        add(jLabel2);
        add(new_pass_field);

        jLabel3.setText("Repeat New Password");
        add(jLabel3);
        add(new_pass_field2);

        confirm_button.setText("Confirm");
        confirm_button.setName("confirm_button"); // NOI18N
        confirm_button.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                confirm_buttonActionPerformed(evt);
            }
        });
        add(confirm_button);

        cancel_button.setText("Cancel");
        cancel_button.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cancel_buttonActionPerformed(evt);
            }
        });
        add(cancel_button);
    }// </editor-fold>//GEN-END:initComponents

    private void confirm_buttonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_confirm_buttonActionPerformed
	String curr  = new String(curr_pass_field.getPassword());
	String newP  = new String(new_pass_field.getPassword());
	String newP2 = new String(new_pass_field2.getPassword());

        if (! curr.equals(a.getPassword())) {
	    JOptionPane.showMessageDialog(this, "Current password given isn't correct.");
	} else if (! newP.equals(newP2)) {
	    JOptionPane.showMessageDialog(this, "The two new passwords given do not match.");
	} else if (newP.isEmpty() || newP2.isEmpty()) {
	    JOptionPane.showMessageDialog(this, "Empty passwords are not allowed.");
	} else {
	    a.setPassword(newP);
	    AccountAccess.modifyAccount(a.getUsername(), a);
	    System.out.println("Password changed to " + newP);
	}
    }//GEN-LAST:event_confirm_buttonActionPerformed

    private void cancel_buttonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_cancel_buttonActionPerformed
        GUIUtils.getMasterFrame(this)
	    .goBackAction(new ActionEvent(this, 5, null));
    }//GEN-LAST:event_cancel_buttonActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton cancel_button;
    private javax.swing.JButton confirm_button;
    private javax.swing.JPasswordField curr_pass_field;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JPasswordField new_pass_field;
    private javax.swing.JPasswordField new_pass_field2;
    // End of variables declaration//GEN-END:variables
}
